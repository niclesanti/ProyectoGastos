<?xml version="1.0" encoding="UTF-8"?>
<configuration>

    <!--
        Este archivo de configuracion de Logback es detectado automaticamente por Spring Boot.
        Permite un control mas avanzado sobre los logs que el que se puede lograr solo con application.properties.
    -->

    <!-- Importamos configuraciones base de Spring Boot para no empezar de cero -->
    <include resource="org/springframework/boot/logging/logback/base.xml"/>

    <!--
        ====================================================================
        CONFIGURACION PARA EL PERFIL DE DESARROLLO (dev)
        ====================================================================
    -->
    <springProfile name="dev">
        <!--
            En desarrollo, la configuracion por defecto de Spring (consola) es suficiente.
            Las propiedades definidas en application-dev.properties seran aplicadas.
            Podriamos anadir appenders especificos para dev aqui si fuera necesario.
        -->
        <logger name="com.campito.backend" level="DEBUG" additivity="false">
            <appender-ref ref="CONSOLE" />
            <appender-ref ref="FILE" />
        </logger>
    </springProfile>

    <!--
        ====================================================================
        CONFIGURACION PARA EL PERFIL DE PRODUCCION (prod)
        ====================================================================
    -->
    <springProfile name="prod">
        <!--
            En produccion, usamos solo logs de consola.
            El appender JSON fue deshabilitado para evitar la dependencia de logstash-logback-encoder
            en ambientes de staging/hosting como Render que capturan logs de consola automÃ¡ticamente.
        -->

        <!--
            Appender JSON comentado - requiere dependencia net.logstash.logback:logstash-logback-encoder
        
        <appender name="ROLLING_FILE_JSON" class="ch.qos.logback.core.rolling.RollingFileAppender">
            <file>logs/backend-prod.log</file>
            <encoder class="net.logstash.logback.encoder.LogstashEncoder"/>
            <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
                <fileNamePattern>logs/backend-prod.%d{yyyy-MM-dd}.log.gz</fileNamePattern>
                <maxHistory>30</maxHistory>
                <cleanHistoryOnStart>true</cleanHistoryOnStart>
            </rollingPolicy>
        </appender>
        -->

        <!--
            Appender de consola para produccion. Suficiente para staging en Render.
        -->
        <appender name="PROD_CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
            <encoder>
                <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
            </encoder>
        </appender>

        <!--
            Configuracion del logger raiz (root).
            Todos los logs iran solo a la consola.
        -->
        <root level="WARN">
            <appender-ref ref="PROD_CONSOLE" />
        </root>

        <!--
            Logger especifico para nuestro paquete.
        -->
        <logger name="com.campito.backend" level="WARN" additivity="false">
            <appender-ref ref="PROD_CONSOLE" />
        </logger>

    </springProfile>

</configuration>
